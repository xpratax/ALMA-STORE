<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Minha Loja</title>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body {
      background: #0b0b10;
      color: #fff;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }

    .loja-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .loja-header h1 {
      font-size: 2.4rem;
      color: #8f7cff;
    }

    .produtos {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
    }

    .card {
      background: #12121a;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 0 15px #8f7cff44;
    }

    .card h3 {
      margin: 0 0 8px;
    }

    .preco {
      margin-top: 10px;
      font-weight: bold;
      color: #00ffcc;
    }
  </style>
</head>

<body>

  <div class="loja-header">
    <h1 id="nomeLoja">Carregando loja...</h1>
  </div>

  <div class="produtos" id="listaProdutos"></div>

<script>
/* ðŸ”‘ SUPABASE */
const SUPABASE_URL = "https://dzwerhytdemnwebqurau.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR6d2VyaHl0ZGVtbndlYnF1cmF1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3NzQ5NzEsImV4cCI6MjA4MjM1MDk3MX0.m0ZEcR_A7uEMJ0ixVThqNcI0lLlc2vCQitcyjtT0MDM";

const supabase = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

/* ðŸ“Œ PEGAR SLUG DA URL */
const params = new URLSearchParams(window.location.search);
const slug = params.get("slug");

if (!slug) {
  document.body.innerHTML = "<h2>Loja nÃ£o encontrada</h2>";
  throw new Error("Slug nÃ£o informado");
}

/* ðŸ”Ž BUSCAR LOJA PELO SLUG */
async function carregarLoja() {
  const { data: loja, error } = await supabase
    .from("lojas")
    .select("id, nome")
    .eq("slug", slug)
    .single();

  if (error || !loja) {
    document.body.innerHTML = "<h2>Loja nÃ£o encontrada</h2>";
    return;
  }

  document.getElementById("nomeLoja").innerText = loja.nome;

  carregarProdutos(loja.id);
}

/* ðŸ›’ BUSCAR PRODUTOS DA LOJA */
async function carregarProdutos(lojaId) {
  const { data: produtos, error } = await supabase
    .from("produtos_geral")
    .select("nome, preco")
    .eq("loja_id", lojaId)
    .eq("status", "permitido");

  if (error) {
    console.error(error);
    return;
  }

  const box = document.getElementById("listaProdutos");
  box.innerHTML = "";

  produtos.forEach(p => {
    box.innerHTML += `
      <div class="card">
        <h3>${p.nome}</h3>
        <div class="preco">R$ ${Number(p.preco).toFixed(2)}</div>
      </div>
    `;
  });
}

carregarLoja();
</script>

</body>
</html>
